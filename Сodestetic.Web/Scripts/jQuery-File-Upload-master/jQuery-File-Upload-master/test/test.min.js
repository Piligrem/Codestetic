$(function(){"use strict";QUnit.done=function(){var n=$("#fileupload").prop("action");$.getJSON(n,function(t){$.each(t.files,function(t,i){$.ajax({url:n+"?file="+encodeURIComponent(i.name),type:"DELETE"})})})};var n={setup:function(){$.widget("blueimp.fileupload",window.testBasicWidget,{})},teardown:function(){$(document).unbind()}},t={setup:function(){$.widget("blueimp.fileupload",window.testUIWidget,{})},teardown:function(){$(document).unbind()}};module("Initialization",n);test("Widget initialization",function(){var n=$("#fileupload").fileupload();ok(n.data("blueimp-fileupload")||n.data("fileupload"))});test("Data attribute options",function(){$("#fileupload").attr("data-url","http://example.org");$("#fileupload").fileupload();strictEqual($("#fileupload").fileupload("option","url"),"http://example.org")});test("File input initialization",function(){var n=$("#fileupload").fileupload();ok(n.fileupload("option","fileInput").length,"File input field inside of the widget");ok(n.fileupload("option","fileInput").length,"Widget element as file input field")});test("Drop zone initialization",function(){ok($("#fileupload").fileupload().fileupload("option","dropZone").length)});test("Paste zone initialization",function(){ok($("#fileupload").fileupload().fileupload("option","pasteZone").length)});test("Event listeners initialization",function(){expect($.support.xhrFormDataFileUpload?4:1);var n={originalEvent:{dataTransfer:{files:[{}],types:["Files"]},clipboardData:{items:[{}]}}},t=$("#fileupload").fileupload({dragover:function(){return ok(!0,"Triggers dragover callback"),!1},drop:function(){return ok(!0,"Triggers drop callback"),!1},paste:function(){return ok(!0,"Triggers paste callback"),!1},change:function(){return ok(!0,"Triggers change callback"),!1}}),r=t.fileupload("option","fileInput"),i=t.fileupload("option","dropZone"),u=t.fileupload("option","pasteZone");r.trigger($.Event("change",n));i.trigger($.Event("dragover",n));i.trigger($.Event("drop",n));u.trigger($.Event("paste",n))});module("API",n);test("destroy",function(){expect(4);var t={originalEvent:{dataTransfer:{files:[{}],types:["Files"]},clipboardData:{items:[{}]}}},n={dragover:function(){return ok(!0,"Triggers dragover callback"),!1},drop:function(){return ok(!0,"Triggers drop callback"),!1},paste:function(){return ok(!0,"Triggers paste callback"),!1},change:function(){return ok(!0,"Triggers change callback"),!1}},i=$("#fileupload").fileupload(n),u=i.fileupload("option","fileInput"),r=i.fileupload("option","dropZone"),f=i.fileupload("option","pasteZone");r.bind("dragover",n.dragover);r.bind("drop",n.drop);f.bind("paste",n.paste);u.bind("change",n.change);i.fileupload("destroy");u.trigger($.Event("change",t));r.trigger($.Event("dragover",t));r.trigger($.Event("drop",t));f.trigger($.Event("paste",t))});test("disable/enable",function(){expect($.support.xhrFormDataFileUpload?4:1);var n={originalEvent:{dataTransfer:{files:[{}],types:["Files"]},clipboardData:{items:[{}]}}},t=$("#fileupload").fileupload({dragover:function(){return ok(!0,"Triggers dragover callback"),!1},drop:function(){return ok(!0,"Triggers drop callback"),!1},paste:function(){return ok(!0,"Triggers paste callback"),!1},change:function(){return ok(!0,"Triggers change callback"),!1}}),r=t.fileupload("option","fileInput"),i=t.fileupload("option","dropZone"),u=t.fileupload("option","pasteZone");t.fileupload("disable");r.trigger($.Event("change",n));i.trigger($.Event("dragover",n));i.trigger($.Event("drop",n));u.trigger($.Event("paste",n));t.fileupload("enable");r.trigger($.Event("change",n));i.trigger($.Event("dragover",n));i.trigger($.Event("drop",n));u.trigger($.Event("paste",n))});test("option",function(){expect($.support.xhrFormDataFileUpload?10:7);var t={originalEvent:{dataTransfer:{files:[{}],types:["Files"]},clipboardData:{items:[{}]}}},n=$("#fileupload").fileupload({dragover:function(){return ok(!0,"Triggers dragover callback"),!1},drop:function(){return ok(!0,"Triggers drop callback"),!1},paste:function(){return ok(!0,"Triggers paste callback"),!1},change:function(){return ok(!0,"Triggers change callback"),!1}}),r=n.fileupload("option","fileInput"),i=n.fileupload("option","dropZone"),u=n.fileupload("option","pasteZone");n.fileupload("option","fileInput",null);n.fileupload("option","dropZone",null);n.fileupload("option","pasteZone",null);r.trigger($.Event("change",t));i.trigger($.Event("dragover",t));i.trigger($.Event("drop",t));u.trigger($.Event("paste",t));n.fileupload("option","dropZone","body");strictEqual(n.fileupload("option","dropZone")[0],document.body,"Allow a query string as parameter for the dropZone option");n.fileupload("option","dropZone",document);strictEqual(n.fileupload("option","dropZone")[0],document,"Allow a document element as parameter for the dropZone option");n.fileupload("option","pasteZone","body");strictEqual(n.fileupload("option","pasteZone")[0],document.body,"Allow a query string as parameter for the pasteZone option");n.fileupload("option","pasteZone",document);strictEqual(n.fileupload("option","pasteZone")[0],document,"Allow a document element as parameter for the pasteZone option");n.fileupload("option","fileInput",":file");strictEqual(n.fileupload("option","fileInput")[0],$(":file")[0],"Allow a query string as parameter for the fileInput option");n.fileupload("option","fileInput",$(":file")[0]);strictEqual(n.fileupload("option","fileInput")[0],$(":file")[0],"Allow a document element as parameter for the fileInput option");n.fileupload("option","fileInput",r);n.fileupload("option","dropZone",i);n.fileupload("option","pasteZone",u);r.trigger($.Event("change",t));i.trigger($.Event("dragover",t));i.trigger($.Event("drop",t));u.trigger($.Event("paste",t))});asyncTest("add",function(){expect(2);var n={files:[{name:"test"}]};$("#fileupload").fileupload({add:function(t,i){strictEqual(i.files[0].name,n.files[0].name,"Triggers add callback")}}).fileupload("add",n).fileupload("option","add",function(n,t){t.submit().complete(function(){ok(!0,"data.submit() Returns a jqXHR object");start()})}).fileupload("add",n)});asyncTest("send",function(){expect(3);$("#fileupload").fileupload({send:function(n,t){strictEqual(t.files[0].name,"test","Triggers send callback")}}).fileupload("send",{files:[{name:"test"}]}).fail(function(){ok(!0,"Allows to abort the request")}).complete(function(){ok(!0,"Returns a jqXHR object");start()}).abort()});module("Callbacks",n);asyncTest("add",function(){expect(1);$("#fileupload").fileupload({add:function(){ok(!0,"Triggers add callback");start()}}).fileupload("add",{files:[{name:"test"}]})});asyncTest("submit",function(){expect(1);$("#fileupload").fileupload({submit:function(){return ok(!0,"Triggers submit callback"),start(),!1}}).fileupload("add",{files:[{name:"test"}]})});asyncTest("send",function(){expect(1);$("#fileupload").fileupload({send:function(){return ok(!0,"Triggers send callback"),start(),!1}}).fileupload("send",{files:[{name:"test"}]})});asyncTest("done",function(){expect(1);$("#fileupload").fileupload({done:function(){ok(!0,"Triggers done callback");start()}}).fileupload("send",{files:[{name:"test"}]})});asyncTest("fail",function(){expect(1);var n=$("#fileupload").fileupload({url:"404",fail:function(){ok(!0,"Triggers fail callback");start()}});(n.data("blueimp-fileupload")||n.data("fileupload"))._isXHRUpload=function(){return!0};n.fileupload("send",{files:[{name:"test"}]})});asyncTest("always",function(){expect(2);var t={files:[{name:"test"}]},i=0,n=$("#fileupload").fileupload({always:function(){ok(!0,"Triggers always callback");i===1?start():i+=1}});(n.data("blueimp-fileupload")||n.data("fileupload"))._isXHRUpload=function(){return!0};n.fileupload("add",t).fileupload("option","url","404").fileupload("add",t)});asyncTest("progress",function(){expect(1);var n=0;$("#fileupload").fileupload({forceIframeTransport:!0,progress:function(){ok(!0,"Triggers progress callback");n===0?start():n+=1}}).fileupload("send",{files:[{name:"test"}]})});asyncTest("progressall",function(){expect(1);var n=0;$("#fileupload").fileupload({forceIframeTransport:!0,progressall:function(){ok(!0,"Triggers progressall callback");n===0?start():n+=1}}).fileupload("send",{files:[{name:"test"}]})});asyncTest("start",function(){expect(1);var n=0;$("#fileupload").fileupload({send:function(){n+=1},start:function(){ok(!n,"Triggers start callback before uploads");start()}}).fileupload("send",{files:[{name:"1"},{name:"2"}]})});asyncTest("stop",function(){expect(1);var n=0;$("#fileupload").fileupload({send:function(){n+=1},always:function(){n-=1},stop:function(){ok(!n,"Triggers stop callback after uploads");start()}}).fileupload("send",{files:[{name:"1"},{name:"2"}]})});test("change",function(){var n=$("#fileupload").fileupload(),t=n.data("blueimp-fileupload")||n.data("fileupload"),i=n.fileupload("option","fileInput");expect(2);n.fileupload({change:function(n,t){ok(!0,"Triggers change callback");strictEqual(t.files.length,0,"Returns empty files list")},add:$.noop});t._onChange({data:{fileupload:t},target:i[0]})});test("paste",function(){var n=$("#fileupload").fileupload(),t=n.data("blueimp-fileupload")||n.data("fileupload");expect(1);n.fileupload({paste:function(){ok(!0,"Triggers paste callback")},add:$.noop});t._onPaste({data:{fileupload:t},originalEvent:{dataTransfer:{files:[{}]},clipboardData:{items:[{}]}},preventDefault:$.noop})});test("drop",function(){var n=$("#fileupload").fileupload(),t=n.data("blueimp-fileupload")||n.data("fileupload");expect(1);n.fileupload({drop:function(){ok(!0,"Triggers drop callback")},add:$.noop});t._onDrop({data:{fileupload:t},originalEvent:{dataTransfer:{files:[{}]},clipboardData:{items:[{}]}},preventDefault:$.noop})});test("dragover",function(){var n=$("#fileupload").fileupload(),t=n.data("blueimp-fileupload")||n.data("fileupload");expect(1);n.fileupload({dragover:function(){ok(!0,"Triggers dragover callback")},add:$.noop});t._onDragOver({data:{fileupload:t},originalEvent:{dataTransfer:{types:["Files"]}},preventDefault:$.noop})});module("Options",n);test("paramName",function(){expect(1);$("#fileupload").fileupload({paramName:null,send:function(n,t){return strictEqual(t.paramName[0],t.fileInput.prop("name"),"Takes paramName from file input field if not set"),!1}}).fileupload("send",{files:[{name:"test"}]})});test("url",function(){expect(1);$("#fileupload").fileupload({url:null,send:function(n,t){return strictEqual(t.url,$(t.fileInput.prop("form")).prop("action"),"Takes url from form action if not set"),!1}}).fileupload("send",{files:[{name:"test"}]})});test("type",function(){expect(2);var n={files:[{name:"test"}]};$("#fileupload").fileupload({type:null,send:function(n,t){return strictEqual(t.type,"POST",'Request type is "POST" if not set to "PUT"'),!1}}).fileupload("send",n);$("#fileupload").fileupload({type:"PUT",send:function(n,t){return strictEqual(t.type,"PUT",'Request type is "PUT" if set to "PUT"'),!1}}).fileupload("send",n)});test("replaceFileInput",function(){var n=$("#fileupload").fileupload(),t=n.data("blueimp-fileupload")||n.data("fileupload"),i=n.fileupload("option","fileInput"),r=i[0];expect(2);n.fileupload({replaceFileInput:!1,change:function(){strictEqual(n.fileupload("option","fileInput")[0],r,"Keeps file input with replaceFileInput: false")},add:$.noop});t._onChange({data:{fileupload:t},target:i[0]});n.fileupload({replaceFileInput:!0,change:function(){notStrictEqual(n.fileupload("option","fileInput")[0],r,"Replaces file input with replaceFileInput: true")},add:$.noop});t._onChange({data:{fileupload:t},target:i[0]})});asyncTest("forceIframeTransport",function(){expect(1);$("#fileupload").fileupload({forceIframeTransport:!0,done:function(n,t){strictEqual(t.dataType.substr(0,6),"iframe","Iframe Transport is used");start()}}).fileupload("send",{files:[{name:"test"}]})});test("singleFileUploads",function(){expect(3);var n=$("#fileupload").fileupload(),t={files:[{name:"1"},{name:"2"}]},i=1;(n.data("blueimp-fileupload")||n.data("fileupload"))._isXHRUpload=function(){return!0};$("#fileupload").fileupload({singleFileUploads:!0,add:function(){ok(!0,"Triggers callback number "+i.toString());i+=1}}).fileupload("add",t).fileupload("option","singleFileUploads",!1).fileupload("add",t)});test("limitMultiFileUploads",function(){expect(3);var n=$("#fileupload").fileupload(),t=1;(n.data("blueimp-fileupload")||n.data("fileupload"))._isXHRUpload=function(){return!0};$("#fileupload").fileupload({singleFileUploads:!1,limitMultiFileUploads:2,add:function(){ok(!0,"Triggers callback number "+t.toString());t+=1}}).fileupload("add",{files:[{name:"1"},{name:"2"},{name:"3"},{name:"4"},{name:"5"}]})});test("limitMultiFileUploadSize",function(){expect(7);var n=$("#fileupload").fileupload(),t=1;(n.data("blueimp-fileupload")||n.data("fileupload"))._isXHRUpload=function(){return!0};$("#fileupload").fileupload({singleFileUploads:!1,limitMultiFileUploads:2,limitMultiFileUploadSize:15e4,limitMultiFileUploadSizeOverhead:5e3,add:function(){ok(!0,"Triggers callback number "+t.toString());t+=1}}).fileupload("add",{files:[{name:"1-1",size:1e5},{name:"1-2",size:4e4},{name:"2-1",size:1e5},{name:"3-1",size:5e4},{name:"3-2",size:4e4},{name:"4-1",size:45e3}]}).fileupload("add",{files:[{name:"5-1"},{name:"5-2"},{name:"6-1"},{name:"6-2"},{name:"7-1"}]})});asyncTest("sequentialUploads",function(){expect(6);var t=0,i=0,r=0,n=$("#fileupload").fileupload({sequentialUploads:!0,add:function(n,i){t+=1;t===4?i.submit().abort():i.submit()},send:function(){i+=1},done:function(){r+=1;strictEqual(i,r,"upload in order")},fail:function(n,t){strictEqual(t.errorThrown,"abort","upload aborted")},stop:function(){start()}});(n.data("blueimp-fileupload")||n.data("fileupload"))._isXHRUpload=function(){return!0};n.fileupload("add",{files:[{name:"1"},{name:"2"},{name:"3"},{name:"4"},{name:"5"},{name:"6"}]})});asyncTest("limitConcurrentUploads",function(){expect(12);var t=0,i=0,r=0,n=$("#fileupload").fileupload({limitConcurrentUploads:3,add:function(n,i){t+=1;t===4?i.submit().abort():i.submit()},send:function(){i+=1},done:function(){r+=1;ok(i-r<3)},fail:function(n,t){strictEqual(t.errorThrown,"abort","upload aborted")},stop:function(){start()}});(n.data("blueimp-fileupload")||n.data("fileupload"))._isXHRUpload=function(){return!0};n.fileupload("add",{files:[{name:"1"},{name:"2"},{name:"3"},{name:"4"},{name:"5"},{name:"6"},{name:"7"},{name:"8"},{name:"9"},{name:"10"},{name:"11"},{name:"12"}]})});$.support.xhrFileUpload&&asyncTest("multipart",function(){expect(2);var n={files:[{name:"test.png",size:123,type:"image/png"}]},t=$("#fileupload").fileupload({multipart:!1,always:function(t,i){strictEqual(i.contentType,n.files[0].type,"non-multipart upload sets file type as contentType");strictEqual(i.headers["Content-Disposition"],'attachment; filename="'+n.files[0].name+'"',"non-multipart upload sets Content-Disposition header");start()}});t.fileupload("send",n)});module("UI Initialization",t);test("Widget initialization",function(){var n=$("#fileupload").fileupload();ok(n.data("blueimp-fileupload")||n.data("fileupload"));ok($("#fileupload").fileupload("option","uploadTemplate").length,"Initialized upload template");ok($("#fileupload").fileupload("option","downloadTemplate").length,"Initialized download template")});test("Buttonbar event listeners",function(){var n=$("#fileupload .fileupload-buttonbar"),t=[{name:"test"}];expect(4);$("#fileupload").fileupload({send:function(){ok(!0,"Started file upload via global start button")},fail:function(n,t){ok(!0,"Canceled file upload via global cancel button");t.context.remove()},destroy:function(){ok(!0,"Delete action called via global delete button")}});$("#fileupload").fileupload("add",{files:t});n.find(".cancel").click();$("#fileupload").fileupload("add",{files:t});n.find(".start").click();n.find(".cancel").click();t[0].deleteUrl="http://example.org/banana.jpg";($("#fileupload").data("blueimp-fileupload")||$("#fileupload").data("fileupload"))._renderDownload(t).appendTo($("#fileupload .files")).show().find(".toggle").click();n.find(".delete").click()});module("UI API",t);test("destroy",function(){var n=$("#fileupload .fileupload-buttonbar");expect(1);$("#fileupload").fileupload({send:function(){return ok(!0,"This test should not run"),!1}}).fileupload("add",{files:[{name:"test"}]}).fileupload("destroy");n.find(".start").click(function(){return ok(!0,"Clicked global start button"),!1}).click()});test("disable/enable",function(){var n=$("#fileupload .fileupload-buttonbar");$("#fileupload").fileupload();$("#fileupload").fileupload("disable");strictEqual(n.find("input[type=file], button").not(":disabled").length,0,"Disables the buttonbar buttons");$("#fileupload").fileupload("enable");strictEqual(n.find("input[type=file], button").not(":disabled").length,4,"Enables the buttonbar buttons")});module("UI Callbacks",t);test("destroy",function(){expect(3);$("#fileupload").fileupload({destroy:function(n,t){ok(!0,"Triggers destroy callback");strictEqual(t.url,"test","Passes over deletion url parameter");strictEqual(t.type,"DELETE","Passes over deletion request type parameter")}});($("#fileupload").data("blueimp-fileupload")||$("#fileupload").data("fileupload"))._renderDownload([{name:"test",deleteUrl:"test",deleteType:"DELETE"}]).appendTo($("#fileupload .files")).show().find(".toggle").click();$("#fileupload .fileupload-buttonbar .delete").click()});asyncTest("added",function(){expect(1);var n={files:[{name:"test"}]};$("#fileupload").fileupload({added:function(t,i){start();strictEqual(i.files[0].name,n.files[0].name,"Triggers added callback")},send:function(){return!1}}).fileupload("add",n)});asyncTest("started",function(){expect(1);$("#fileupload").fileupload({started:function(){return start(),ok("Triggers started callback"),!1},sent:function(){return!1}}).fileupload("send",{files:[{name:"test"}]})});asyncTest("sent",function(){expect(1);var n={files:[{name:"test"}]};$("#fileupload").fileupload({sent:function(t,i){return start(),strictEqual(i.files[0].name,n.files[0].name,"Triggers sent callback"),!1}}).fileupload("send",n)});asyncTest("completed",function(){expect(1);$("#fileupload").fileupload({completed:function(){return start(),ok("Triggers completed callback"),!1}}).fileupload("send",{files:[{name:"test"}]})});asyncTest("failed",function(){expect(1);$("#fileupload").fileupload({failed:function(){return start(),ok("Triggers failed callback"),!1}}).fileupload("send",{files:[{name:"test"}]}).abort()});asyncTest("stopped",function(){expect(1);$("#fileupload").fileupload({stopped:function(){return start(),ok("Triggers stopped callback"),!1}}).fileupload("send",{files:[{name:"test"}]})});asyncTest("destroyed",function(){expect(1);$("#fileupload").fileupload({dataType:"html",destroyed:function(){start();ok(!0,"Triggers destroyed callback")}});($("#fileupload").data("blueimp-fileupload")||$("#fileupload").data("fileupload"))._renderDownload([{name:"test",deleteUrl:".",deleteType:"GET"}]).appendTo($("#fileupload .files")).show().find(".toggle").click();$("#fileupload .fileupload-buttonbar .delete").click()});module("UI Options",t);test("autoUpload",function(){expect(1);$("#fileupload").fileupload({autoUpload:!0,send:function(){return ok(!0,"Started file upload automatically"),!1}}).fileupload("add",{files:[{name:"test"}]}).fileupload("option","autoUpload",!1).fileupload("add",{files:[{name:"test"}]})});test("maxNumberOfFiles",function(){expect(3);var n=0,t=0;$("#fileupload").fileupload({autoUpload:!0,maxNumberOfFiles:3,singleFileUploads:!1,send:function(){strictEqual(t+=1,n)},progress:$.noop,progressall:$.noop,done:$.noop,stop:$.noop}).fileupload("add",{files:[{name:n+=1}]}).fileupload("add",{files:[{name:n+=1}]}).fileupload("add",{files:[{name:n+=1}]}).fileupload("add",{files:[{name:"test"}]})});test("maxFileSize",function(){expect(2);var n=0,t=0;$("#fileupload").fileupload({autoUpload:!0,maxFileSize:1e3,send:function(){return strictEqual(t+=1,n),!1}}).fileupload("add",{files:[{name:n+=1}]}).fileupload("add",{files:[{name:n+=1,size:999}]}).fileupload("add",{files:[{name:"test",size:1001}]}).fileupload({send:function(n,t){return ok(!$.blueimp.fileupload.prototype.options.send.call(this,n,t)),!1}})});test("minFileSize",function(){expect(2);var n=0,t=0;$("#fileupload").fileupload({autoUpload:!0,minFileSize:1e3,send:function(){return strictEqual(t+=1,n),!1}}).fileupload("add",{files:[{name:n+=1}]}).fileupload("add",{files:[{name:n+=1,size:1001}]}).fileupload("add",{files:[{name:"test",size:999}]}).fileupload({send:function(n,t){return ok(!$.blueimp.fileupload.prototype.options.send.call(this,n,t)),!1}})});test("acceptFileTypes",function(){expect(2);var n=0,t=0;$("#fileupload").fileupload({autoUpload:!0,acceptFileTypes:/(\.|\/)(gif|jpe?g|png)$/i,disableImageMetaDataLoad:!0,send:function(){return strictEqual(t+=1,n),!1}}).fileupload("add",{files:[{name:(n+=1)+".jpg"}]}).fileupload("add",{files:[{name:n+=1,type:"image/jpeg"}]}).fileupload("add",{files:[{name:"test.txt",type:"text/plain"}]}).fileupload({send:function(n,t){return ok(!$.blueimp.fileupload.prototype.options.send.call(this,n,t)),!1}})});test("acceptFileTypes as HTML5 data attribute",function(){expect(2);var n=/(\.|\/)(gif|jpe?g|png)$/i;$("#fileupload").attr("data-accept-file-types",n.toString()).fileupload();strictEqual($.type($("#fileupload").fileupload("option","acceptFileTypes")),$.type(n));strictEqual($("#fileupload").fileupload("option","acceptFileTypes").toString(),n.toString())})});
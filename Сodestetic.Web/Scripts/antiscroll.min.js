(function(n){function i(t,i){this.el=n(t);this.options=i||{};this.x=!1!==this.options.x||this.options.forceHorizontal;this.y=!1!==this.options.y||this.options.forceVertical;this.autoHide=!1!==this.options.autoHide;this.padding=undefined==this.options.padding?2:this.options.padding;this.inner=this.el.find(".antiscroll-inner");this.inner.css({width:"+="+(this.y?r():0),height:"+="+(this.x?r():0)});this.refresh()}function t(t){this.pane=t;this.pane.el.append(this.el);this.innerEl=this.pane.inner.get(0);this.dragging=!1;this.enter=!1;this.shown=!1;this.pane.el.mouseenter(n.proxy(this,"mouseenter"));this.pane.el.mouseleave(n.proxy(this,"mouseleave"));this.el.mousedown(n.proxy(this,"mousedown"));this.innerPaneScrollListener=n.proxy(this,"scroll");this.pane.inner.scroll(this.innerPaneScrollListener);this.innerPaneMouseWheelListener=n.proxy(this,"mousewheel");this.pane.inner.bind("mousewheel",this.innerPaneMouseWheelListener);var i=this.pane.options.initialDisplay;i!==!1&&(this.show(),this.pane.autoHide&&(this.hiding=setTimeout(n.proxy(this,"hide"),parseInt(i,10)||3e3)))}function f(n,t){function i(){}i.prototype=t.prototype;n.prototype=new i}function r(){var t,i,r;return u===undefined&&(t=n('<div class="antiscroll-inner" style="width:50px;height:50px;overflow-y:scroll;position:absolute;top:-200px;left:-200px;"><div style="height:100px;width:100%"/><\/div>'),n("body").append(t),i=n(t).innerWidth(),r=n("div",t).innerWidth(),n(t).remove(),u=i-r),u}n.fn.antiscroll=function(t){return this.each(function(){n(this).data("antiscroll")&&n(this).data("antiscroll").destroy();n(this).data("antiscroll",new n.Antiscroll(this,t))})};n.Antiscroll=i;i.prototype.refresh=function(){var n=this.inner.get(0).scrollWidth>this.el.width()+(this.y?r():0),i=this.inner.get(0).scrollHeight>this.el.height()+(this.x?r():0);this.x&&(!this.horizontal&&n?this.horizontal=new t.Horizontal(this):this.horizontal&&!n?(this.horizontal.destroy(),this.horizontal=null):this.horizontal&&this.horizontal.update());this.y&&(!this.vertical&&i?this.vertical=new t.Vertical(this):this.vertical&&!i?(this.vertical.destroy(),this.vertical=null):this.vertical&&this.vertical.update())};i.prototype.destroy=function(){return this.horizontal&&(this.horizontal.destroy(),this.horizontal=null),this.vertical&&(this.vertical.destroy(),this.vertical=null),this};i.prototype.rebuild=function(){return this.destroy(),this.inner.attr("style",""),i.call(this,this.el,this.options),this};t.prototype.destroy=function(){return this.el.remove(),this.pane.inner.unbind("scroll",this.innerPaneScrollListener),this.pane.inner.unbind("mousewheel",this.innerPaneMouseWheelListener),this};t.prototype.mouseenter=function(){this.enter=!0;this.show()};t.prototype.mouseleave=function(){this.enter=!1;this.dragging||this.pane.autoHide&&this.hide()};t.prototype.scroll=function(){this.shown||(this.show(),this.enter||this.dragging||this.pane.autoHide&&(this.hiding=setTimeout(n.proxy(this,"hide"),1500)));this.update()};t.prototype.mousedown=function(t){t.preventDefault();this.dragging=!0;this.startPageY=t.pageY-parseInt(this.el.css("top"),10);this.startPageX=t.pageX-parseInt(this.el.css("left"),10);this.el[0].ownerDocument.onselectstart=function(){return!1};var u=this.pane,r=n.proxy(this,"mousemove"),i=this;n(this.el[0].ownerDocument).mousemove(r).mouseup(function(){i.dragging=!1;this.onselectstart=null;n(this).unbind("mousemove",r);i.enter||i.hide()})};t.prototype.show=function(){!this.shown&&this.update()&&(this.el.addClass("antiscroll-scrollbar-shown"),this.hiding&&(clearTimeout(this.hiding),this.hiding=null),this.shown=!0)};t.prototype.hide=function(){this.pane.autoHide!==!1&&this.shown&&(this.el.removeClass("antiscroll-scrollbar-shown"),this.shown=!1)};t.Horizontal=function(i){this.el=n('<div class="antiscroll-scrollbar antiscroll-scrollbar-horizontal"/>',i.el);t.call(this,i)};f(t.Horizontal,t);t.Horizontal.prototype.update=function(){var t=this.pane.el.width(),i=t-this.pane.padding*2,n=this.pane.inner.get(0);return this.el.css("width",i*t/n.scrollWidth).css("left",i*n.scrollLeft/n.scrollWidth),t<n.scrollWidth};t.Horizontal.prototype.mousemove=function(n){var t=this.pane.el.width()-this.pane.padding*2,u=n.pageX-this.startPageX,i=this.el.width(),r=this.pane.inner.get(0),f=Math.min(Math.max(u,0),t-i);r.scrollLeft=(r.scrollWidth-this.pane.el.width())*f/(t-i)};t.Horizontal.prototype.mousewheel=function(n,t,i){if(i<0&&0==this.pane.inner.get(0).scrollLeft||i>0&&this.innerEl.scrollLeft+Math.ceil(this.pane.el.width())==this.innerEl.scrollWidth)return n.preventDefault(),!1};t.Vertical=function(i){this.el=n('<div class="antiscroll-scrollbar antiscroll-scrollbar-vertical"/>',i.el);t.call(this,i)};f(t.Vertical,t);t.Vertical.prototype.update=function(){var u=this.pane.el.height(),i=u-this.pane.padding*2,r=this.innerEl,n=i*u/r.scrollHeight,t,f;return n=n<20?20:n,t=i*r.scrollTop/r.scrollHeight,t+n>i&&(f=t+n-i,t=t-f-3),this.el.css("height",n).css("top",t),u<r.scrollHeight};t.Vertical.prototype.mousemove=function(n){var t=this.pane.el.height(),i=t-this.pane.padding*2,f=n.pageY-this.startPageY,r=this.el.height(),u=this.innerEl,e=Math.min(Math.max(f,0),i-r);u.scrollTop=(u.scrollHeight-t)*e/(i-r)};t.Vertical.prototype.mousewheel=function(n,t,i,r){if(r>0&&0==this.innerEl.scrollTop||r<0&&this.innerEl.scrollTop+Math.ceil(this.pane.el.height())==this.innerEl.scrollHeight)return n.preventDefault(),!1};var u})(jQuery);